<!-- –í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫ –í–ú–ï–°–¢–û —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –≤ –≤–∞—à–µ–º dashboard.html -->

<!-- –í–∫–ª–∞–¥–∫–∞ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ -->
<div id="portfolio-tab" class="tab-content">
  <div class="content-header">
    <h2>–ú–æ—ë –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</h2>
    <p>–û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ —Ä–∞–±–æ—Ç—ã –≤ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø–æ–¥–ø–∞–ø–∫–∞–º–∏</p>
  </div>
  <button id="addPortfolioCardBtn" class="btn btn-primary">+ –ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞</button>
  <div id="portfolioCards" class="projects-grid"></div>
  <div id="portfolioEmpty" class="empty-state" style="display:none;">
    <div class="empty-icon">üñºÔ∏è</div>
    <h3>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –ø—É—Å—Ç–æ</h3>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞: –ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
<div id="portfolioCardModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</h3>
      <button class="modal-close">&times;</button>
    </div>
    <form id="portfolioCardForm" class="modal-form">
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
        <input type="text" name="title" required>
      </div>
      <div class="form-group">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea name="description"></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-outline modal-cancel">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
    </form>
  </div>
</div>

<!-- –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü <script> –≤ dashboard.html -->
<script>
// === –ü–û–†–¢–§–û–õ–ò–û –° –ü–ê–ü–ö–ê–ú–ò ===
async function loadPortfolio() {
  try {
    const res = await fetch('/api/portfolio');
    const cards = await res.json();
    displayPortfolio(cards);
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ:', err);
  }
}

function displayPortfolio(cards) {
  const grid = document.getElementById('portfolioCards');
  const empty = document.getElementById('portfolioEmpty');
  if (cards.length === 0) {
    grid.innerHTML = '';
    empty.style.display = 'block';
  } else {
    empty.style.display = 'none';
    grid.innerHTML = cards.map(card => `
      <div class="project-card">
        <h3>${card.title}</h3>
        <p>${card.description || '‚Äî'}</p>
        <div class="project-actions">
          <button class="btn btn-outline btn-small open-portfolio-card" data-id="${card.id}">
            –û—Ç–∫—Ä—ã—Ç—å
          </button>
          <button class="btn btn-outline btn-small delete-portfolio-card" data-id="${card.id}">
            –£–¥–∞–ª–∏—Ç—å
          </button>
        </div>
        <div class="portfolio-stats" style="font-size:0.8em; color:#888; margin-top:8px;">
          –§–∞–π–ª–æ–≤: ${card.items?.length || 0}, –ü–∞–ø–æ–∫: ${card.folders?.length || 0}
        </div>
      </div>
    `).join('');
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
document.getElementById('addPortfolioCardBtn')?.addEventListener('click', () => {
  document.getElementById('portfolioCardModal').style.display = 'flex';
});

document.getElementById('portfolioCardForm')?.addEventListener('submit', async (e) => {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target));
  try {
    const res = await fetch('/api/portfolio/card', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if (result.success) {
      document.getElementById('portfolioCardModal').style.display = 'none';
      e.target.reset();
      await loadPortfolio();
      alert('‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!');
    } else {
      alert('‚ùå ' + result.error);
    }
  } catch (err) {
    alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message);
  }
});

document.addEventListener('click', (e) => {
  if (e.target.classList.contains('open-portfolio-card')) {
    window.open(`/portfolio/view?id=${e.target.dataset.id}`, '_blank');
  }
  if (e.target.classList.contains('delete-portfolio-card')) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?')) {
      fetch(`/api/portfolio/card/${e.target.dataset.id}`, { method: 'DELETE' })
        .then(() => loadPortfolio());
    }
  }
});

// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
document.querySelectorAll('.nav-item[data-tab="portfolio"]').forEach(link => {
  link.addEventListener('click', () => loadPortfolio());
});
</script>